<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon City 2026 - Jogue no Seu Ritmo</title>
    
    <!-- Carrega o Tailwind CSS automaticamente para dar o estilo bonito -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- √çcones (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Three.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
    <!-- OrbitControls para movimenta√ß√£o da c√¢mera -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- Post-processing Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

    <!-- Configura√ß√µes de Cores Personalizadas -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: {
                            cyan: '#22d3ee',
                            pink: '#d946ef',
                            yellow: '#facc15'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* Efeitos visuais extras */
        body {
            background-color: black;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }
        
        /* Fundo de Grade (Grid) com anima√ß√£o */
        .retro-grid {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background-image: 
                linear-gradient(to right, rgba(79, 79, 79, 0.2) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(79, 79, 79, 0.2) 1px, transparent 1px);
            background-size: 4rem 4rem;
            mask-image: radial-gradient(ellipse 60% 50% at 50% 0%, #000 70%, transparent 100%);
            -webkit-mask-image: radial-gradient(ellipse 60% 50% at 50% 0%, #000 70%, transparent 100%);
        }

        /* Efeito de brilho nos textos */
        .neon-text-cyan {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.7);
        }
        .neon-text-pink {
            text-shadow: 0 0 10px rgba(217, 70, 239, 0.7);
        }

        /* Bot√£o com efeito inclinado */
        .btn-glitch {
            position: relative;
            overflow: hidden;
        }
        .btn-glitch::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.2);
            transform: skewX(-25deg);
            transition: 0.5s;
        }
        .btn-glitch:hover::before {
            left: 100%;
        }

        /* Efeito de Estrelas e Borda Neon */
        .text-starry {
            background: 
                radial-gradient(circle at 20% 30%, #fff 1px, transparent 1px),
                radial-gradient(circle at 70% 60%, #fff 1px, transparent 1px),
                radial-gradient(circle at 40% 80%, #fff 1px, transparent 1px),
                black;
            background-size: 30px 30px;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: 
                drop-shadow(1px 1px 0px #22d3ee) 
                drop-shadow(-1px -1px 0px #d946ef) 
                drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
            font-weight: 900;
        }

        /* Estilos dos Pr√©dios Vetoriais */
        .building {
            fill: #050505;
            stroke-width: 2;
        }
        .building-cyan {
            stroke: #22d3ee;
            filter: drop-shadow(0 0 8px rgba(34, 211, 238, 0.6));
        }
        .building-pink {
            stroke: #d946ef;
            filter: drop-shadow(0 0 8px rgba(217, 70, 239, 0.6));
        }

        /* Anima√ß√£o de Brilho (Blinking) */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .blink-1 { animation: blink 3s infinite ease-in-out; }
        .blink-2 { animation: blink 4s infinite ease-in-out 1s; }
        .blink-3 { animation: blink 2.5s infinite ease-in-out 0.5s; }
    </style>
</head>
<body class="text-white">

    <!-- Fundo Retr√¥ -->
    <div class="retro-grid"></div>
    <div class="fixed bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-cyan-900/20 to-transparent pointer-events-none -z-10"></div>

    <!-- Navega√ß√£o -->
    <nav id="navbar" class="fixed top-0 w-full z-50 transition-all duration-300 py-6">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="text-2xl font-bold tracking-tighter flex items-center gap-2">
                <span class="text-cyan-400 neon-text-cyan">NEON CITY</span>
                <span class="text-fuchsia-500 neon-text-pink">2026</span>
            </div>
            <button onclick="buyNow()" class="hidden md:block bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-2 px-6 rounded-full shadow-lg shadow-cyan-500/30 transition-transform hover:scale-105">
                BAIXAR AGORA
            </button>
        </div>
    </nav>

    <!-- Hero Section (Cabe√ßalho) -->
    <header class="relative pt-20 pb-4 lg:pt-24 lg:pb-6 px-6">
        <div class="container mx-auto text-center max-w-4xl">
            
            
            <h1 class="text-5xl md:text-7xl lg:text-8xl font-black mb-4 leading-tight tracking-tight text-white">
                A GAL√ÅXIA DAN√áA <br />
                <span class="text-starry">
                    NO SEU RITMO
                </span>
            </h1>
            
            <p class="text-base md:text-lg text-gray-400 mb-6 max-w-4xl mx-auto">Capture blocos de energia, destrua inimigos e desvie de buracos negros. O jogo cria a fase baseado na <strong>SUA M√öSICA</strong>.</p>

            <!-- Container da Cena Vetorial -->
            <section class="relative py-4 px-6 mb-12">
                <div class="container mx-auto max-w-5xl">
                    <div id="game-container" class="relative aspect-video bg-black rounded-2xl border-2 border-white/10 overflow-hidden shadow-2xl shadow-cyan-900/40">
                        <!-- O Canvas do Three.js ser√° injetado aqui -->
                        
                        <!-- Overlay de gradiente para profundidade -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60 pointer-events-none"></div>

                        <!-- Contador de Jogadores Online -->
                        <div class="absolute bottom-4 right-4 text-red-600 font-mono font-bold z-20">
                            PLAYERS ONLINE: <span id="online-players-count">800</span>
                        </div>
                    </div>
                </div>
            </section>

            <div class="flex flex-col md:flex-row items-center justify-center gap-6 mt-6">
                <div class="flex flex-col items-center w-full md:w-auto">
                    <button onclick="buyNow()" class="btn-glitch group relative w-full md:w-auto bg-fuchsia-600 hover:bg-fuchsia-500 text-white text-xl font-bold py-4 px-10 rounded-xl shadow-lg shadow-fuchsia-500/40 transition-transform hover:-translate-y-1">
                        <span class="flex items-center justify-center gap-3">
                            JOGAR AGORA <i data-lucide="arrow-right"></i>
                        </span>
                    </button>
                    <div class="text-cyan-400 text-sm mt-2 font-mono font-bold">Pessoas na fila: <span id="queue-count">...</span></div>
                    <span class="text-red-500 animate-pulse text-sm mt-1 font-bold">üî¥ <span class="visitor-counter">28</span> pessoas est√£o visualizando esta oferta agora</span>
                </div>
                
                <div class="flex flex-col items-start text-left">
                    <span class="text-sm text-gray-400 line-through">De R$ 35,00</span>
                    <span class="text-4xl font-bold text-yellow-400 neon-text-yellow">GR√ÅTIS AGORA</span>
                    <div class="flex flex-col mt-1">
                        <span class="text-xs text-cyan-400 font-bold uppercase tracking-wider">Vers√£o Beta</span>
                        <span class="text-xs text-gray-300">Limitado aos primeiros 1.000 jogadores</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Funcionalidades (Grid) -->
    <section class="relative py-24 bg-gradient-to-b from-transparent to-gray-900/50">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold mb-4 text-white">MEC√ÇNICAS DO CAOS</h2>
                <p class="text-gray-400">Tudo reage √† batida da sua m√∫sica MP3/WAV</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Item 1 -->
                <div class="bg-white/5 border border-white/10 p-8 rounded-2xl hover:bg-white/10 transition-colors hover:border-cyan-500/50 group">
                    <div class="w-14 h-14 bg-cyan-900/50 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i data-lucide="music" class="w-8 h-8 text-cyan-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Sincronia Total</h3>
                    <p class="text-gray-400">O cen√°rio pulsa com o som. Inimigos atacam no grave e power-ups surgem no agudo.</p>
                </div>

                <!-- Item 2 -->
                <div class="bg-white/5 border border-white/10 p-8 rounded-2xl hover:bg-white/10 transition-colors hover:border-fuchsia-500/50 group">
                    <div class="w-14 h-14 bg-fuchsia-900/50 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i data-lucide="crosshair" class="w-8 h-8 text-fuchsia-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Destrua & Colete</h3>
                    <p class="text-gray-400">Exploda inimigos wireframe para dropar muni√ß√£o essencial. Sem ritmo, sem bala.</p>
                </div>

                <!-- Item 3 -->
                <div class="bg-white/5 border border-white/10 p-8 rounded-2xl hover:bg-white/10 transition-colors hover:border-yellow-500/50 group">
                    <div class="w-14 h-14 bg-yellow-900/50 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i data-lucide="alert-triangle" class="w-8 h-8 text-yellow-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Buracos Negros</h3>
                    <p class="text-gray-400">Desvie de buracos que sugam tudo ao redor. A gravidade muda conforme a m√∫sica acelera.</p>
                </div>

                <!-- Item 4 -->
                <div class="bg-white/5 border border-white/10 p-8 rounded-2xl hover:bg-white/10 transition-colors hover:border-green-500/50 group">
                    <div class="w-14 h-14 bg-green-900/50 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i data-lucide="zap" class="w-8 h-8 text-green-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Capture Blocos</h3>
                    <p class="text-gray-400">Pegue os blocos de energia neon para aumentar seu combo e desbloquear o modo F√∫ria.</p>
                </div>

                <!-- Item 5 -->
                <div class="bg-white/5 border border-white/10 p-8 rounded-2xl hover:bg-white/10 transition-colors hover:border-blue-500/50 group">
                    <div class="w-14 h-14 bg-blue-900/50 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i data-lucide="files" class="w-8 h-8 text-blue-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Seus Arquivos</h3>
                    <p class="text-gray-400">Arraste qualquer MP3 para dentro do jogo. O algoritmo cria uma fase √∫nica para cada m√∫sica.</p>
                </div>

                <!-- Item 6 -->
                <div class="bg-white/5 border border-white/10 p-8 rounded-2xl hover:bg-white/10 transition-colors hover:border-red-500/50 group">
                    <div class="w-14 h-14 bg-red-900/50 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i data-lucide="shield-alert" class="w-8 h-8 text-red-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Desafio Hardcore</h3>
                    <p class="text-gray-400">Modo sobreviv√™ncia infinito. Quanto tempo voc√™ dura na sua m√∫sica favorita?</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Se√ß√£o de Compra -->
    <section class="relative py-20 px-6">
        <div class="container mx-auto max-w-4xl">
            <div class="bg-gradient-to-r from-gray-900 to-black border border-white/10 rounded-3xl p-8 md:p-12 relative overflow-hidden text-center shadow-[0_0_50px_rgba(34,211,238,0.15)]">
                
                <!-- Luzes decorativas -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-fuchsia-600/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-cyan-600/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>

                <h2 class="text-3xl md:text-5xl font-bold mb-6 relative z-10 text-white">SUA M√öSICA, SUA BATALHA</h2>
                <p class="text-xl text-gray-300 mb-8 relative z-10">
                    Oferta por tempo limitado. Receba atualiza√ß√µes vital√≠cias.
                </p>

                <div class="flex flex-col items-center justify-center gap-2 mb-8 relative z-10">
                    <div class="text-gray-500 text-lg line-through decoration-red-500 decoration-2">De R$ 35,00</div>
                    <div class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500 drop-shadow-sm">
                        GR√ÅTIS
                    </div>
                </div>

                <button onclick="buyNow()" class="w-full md:w-auto bg-white text-black hover:bg-cyan-400 font-bold text-xl py-4 px-12 rounded-full transition-all transform hover:scale-105 shadow-xl relative z-10">
                    JOGAR AGORA
                </button>

                <div class="text-red-500 animate-pulse text-sm mt-3 font-bold relative z-10">
                    üî¥ <span class="visitor-counter">28</span> pessoas est√£o visualizando esta oferta agora
                </div>

                <div class="mt-4 flex flex-col items-center gap-2 relative z-10">
                    <span class="text-yellow-400 font-bold text-sm tracking-widest uppercase animate-pulse">‚ö° Apenas para os primeiros 1.000 jogadores</span>
                    <span class="text-cyan-300 text-xs bg-cyan-900/50 px-3 py-1 rounded-full border border-cyan-500/30">Vers√£o Beta para Testar</span>
                </div>
                
                <div class="mt-6 flex flex-wrap justify-center gap-6 text-sm text-gray-500 relative z-10">
                    <span class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-green-500"></i> Download Imediato</span>
                    <span class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-green-500"></i> Sem DRM</span>
                    <span class="flex items-center gap-1"><i data-lucide="check" class="w-4 h-4 text-green-500"></i> Windows PC</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Se√ß√£o de Coment√°rios -->
    <section class="py-20 px-6 bg-black/50 border-t border-white/5">
        <div class="container mx-auto max-w-4xl">
            <h2 class="text-3xl font-bold mb-12 text-center flex items-center justify-center gap-3">
                <i data-lucide="message-square" class="text-fuchsia-500"></i> COMUNIDADE NEON
            </h2>

            <!-- Coment√°rios de Exemplo (Prova Social) -->
            <div class="space-y-6 mb-12">
                <div class="bg-white/5 p-6 rounded-2xl border border-white/10">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center font-bold text-xs">MA</div>
                        <div>
                            <p class="font-bold text-sm">Marco_Antony</p>
                            <div class="flex text-yellow-400 scale-75 origin-left">
                                <i data-lucide="star" class="fill-current w-4 h-4"></i>
                                <i data-lucide="star" class="fill-current w-4 h-4"></i>
                                <i data-lucide="star" class="fill-current w-4 h-4"></i>
                                <i data-lucide="star" class="fill-current w-4 h-4"></i>
                                <i data-lucide="star" class="fill-current w-4 h-4"></i>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-400 italic text-sm">"O sistema de detec√ß√£o de batidas √© fenomenal. Joguei com Daft Punk e foi uma experi√™ncia transcendental."</p>
                </div>
            </div>

            <!-- Formul√°rio de Coment√°rio -->
            <div class="bg-white/5 p-8 rounded-3xl border border-white/10">
                <h3 class="text-xl font-bold mb-6">Deixe seu feedback</h3>
                <form id="comment-form" class="space-y-4">
                    <textarea id="comment-text" rows="3" class="w-full bg-black/50 border border-white/10 rounded-xl p-4 text-white focus:border-fuchsia-500 outline-none transition-colors" placeholder="Escreva o que achou do jogo..."></textarea>
                    <button type="submit" class="w-full md:w-auto bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-bold py-3 px-8 rounded-xl transition-all">
                        PUBLICAR COMENT√ÅRIO
                    </button>
                    <div id="comment-error" class="hidden mt-4 p-4 bg-red-500/20 border border-red-500/50 rounded-xl text-red-400 text-sm font-medium flex items-center gap-2">
                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                        <span>A√ß√£o bloqueada! Voc√™ precisa testar a vers√£o Beta do jogo primeiro para liberar seu coment√°rio.</span>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Rodap√© -->
    <footer class="py-10 border-t border-white/5 bg-black text-center text-gray-600 text-sm">
        <div class="container mx-auto px-6">
            <p class="mb-4">&copy; 2024 Neon City 2026 Games. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Container de Notifica√ß√µes Toast -->
    <div id="toast-container" class="fixed top-24 right-6 z-[100] flex flex-col items-end pointer-events-none"></div>

    <!-- Barra fixa mobile -->
    <div class="fixed bottom-0 left-0 w-full bg-black/95 backdrop-blur border-t border-white/10 p-4 z-50 md:hidden flex justify-between items-center shadow-[0_-10px_40px_rgba(0,0,0,0.8)]">
        <div>
            <span class="text-xs text-gray-400 block line-through">R$ 35,00</span>
            <span class="text-xl font-bold text-yellow-400">GR√ÅTIS</span>
        </div>
        <button onclick="buyNow()" class="bg-fuchsia-600 text-white px-6 py-2 rounded-lg font-bold text-sm shadow-lg shadow-fuchsia-500/30">
            BAIXAR
        </button>
    </div>

    <!-- Scripts de L√≥gica -->
    <script>
      window.addEventListener('load', () => {
      try {
        // Configura√ß√µes Globais
        const CONFIG = {
            CHECKOUT_URL: "https://aistudio.google.com/app/prompts?state=%7B%22ids%22:%5B%2217yjwZbhNUM9BWhUzOc2JwrD_Xm_lVDlV%22%5D,%22action%22:%22open%22,%22userId%22:%22101222478788488981462%22,%22resourceKeys%22:%7B%7D%7D&usp=sharing"













        };

        // Verifica√ß√£o de Depend√™ncias
        if (typeof THREE === 'undefined') {
            throw new Error("A biblioteca Three.js n√£o p√¥de ser carregada.");
        }

        // Inicializa os √≠cones
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        } else {
            console.warn("Aviso: Biblioteca de √≠cones Lucide n√£o carregada.");
        }

        // Efeito de rolagem na Navbar
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) {
                nav.classList.add('bg-black/90', 'backdrop-blur-md', 'border-b', 'border-white/10', 'py-4');
                nav.classList.remove('py-6');
            } else {
                nav.classList.remove('bg-black/90', 'backdrop-blur-md', 'border-b', 'border-white/10', 'py-4');
                nav.classList.add('py-6');
            }
        });

        // --- ESTADO CENTRALIZADO DO SERVIDOR ---
        const serverState = {
            MAX_PLAYERS: 800,
            currentOnline: 800,
            queueSize: Math.floor(Math.random() * 15) + 5, // Fila inicial entre 5 e 20
            userPosition: null
        };

        // Atualiza a Interface (DOM) com base no Estado
        function updateServerDisplay() {
            // Atualiza contadores
            const onlineEl = document.getElementById('online-players-count');
            const queueEl = document.getElementById('queue-count');
            
            if (onlineEl) onlineEl.innerText = serverState.currentOnline;
            if (queueEl) queueEl.innerText = serverState.queueSize;

            // Atualiza bot√µes se o usu√°rio estiver na fila
            if (serverState.userPosition !== null) {
                const buttons = document.querySelectorAll('button[onclick="buyNow()"]');
                buttons.forEach(btn => {
                    btn.innerHTML = `Aguardando... Posi√ß√£o: ${serverState.userPosition}`;
                    btn.classList.add('opacity-80', 'cursor-wait');
                    btn.classList.remove('hover:scale-105', 'hover:-translate-y-1', 'group');
                });

                // Redirecionamento se chegou a vez
                if (serverState.userPosition <= 0) {
                    window.location.href = CONFIG.CHECKOUT_URL;
                }
            }
        }

        // Inicializa display
        updateServerDisplay();

        // Fun√ß√£o de Compra (Entrada na Fila)
        window.buyNow = function() {
            if (serverState.userPosition !== null) return; // J√° est√° na fila
            
            serverState.queueSize++;
            serverState.userPosition = serverState.queueSize;
            
            spawnToast('user');
            updateServerDisplay();
        };

        // --- SETUP THREE.JS ---
        const container = document.getElementById('game-container');
        
        // Cena
        const scene = new THREE.Scene();

        // C√¢mera
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(10, 5, 10); // Posi√ß√£o inicial levemente inclinada

        // Renderizador com Transpar√™ncia
        const renderer = new THREE.WebGLRenderer({ 
            alpha: true, 
            antialias: true 
        });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // Controles Orbitais
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 0, 0); // Garante que o alvo seja o centro da cidade
        controls.enableDamping = true; // Suaviza o movimento
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = false;
        controls.minDistance = 5;
        controls.maxDistance = 50;
        controls.maxPolarAngle = Math.PI / 2; // Impede de olhar por baixo do ch√£o
        
        // Auto-orbit: Rotaciona sozinho enquanto o usu√°rio n√£o interage
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.8;

        // --- SISTEMA DE PR√âDIOS E CORES ---
        const buildings = [];
        let particles;
        const neonColors = [0x22d3ee, 0xd946ef, 0xfacc15];

        function createParticles() {
            const count = 1500;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            const colorPalette = [
                new THREE.Color(0x22d3ee), // cyan
                new THREE.Color(0xd946ef), // pink
                new THREE.Color(0xfacc15)  // yellow
            ];

            for (let i = 0; i < count; i++) {
                // Posi√ß√µes aleat√≥rias ao redor dos pr√©dios
                positions[i * 3] = (Math.random() - 0.5) * 40;
                positions[i * 3 + 1] = Math.random() * 20;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 40;

                // Cores neon aleat√≥rias
                const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.06,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        function createCity() {
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            for (let i = 0; i < 40; i++) {
                const color = neonColors[Math.floor(Math.random() * neonColors.length)];
                
                // Material s√≥lido (corpo do pr√©dio) - Preto Absoluto
                const material = new THREE.MeshStandardMaterial({
                    color: 0x000000
                });
                
                const box = new THREE.Mesh(geometry, material);
                
                // Material Wireframe (malha digital por cima)
                const wireframeMaterial = new THREE.MeshBasicMaterial({
                    color: color,
                    wireframe: true,
                    transparent: true,
                    opacity: 0.4
                });
                const wireframe = new THREE.Mesh(geometry, wireframeMaterial);
                box.add(wireframe); // Adiciona a malha como filha do pr√©dio
                
                const x = (Math.random() - 0.5) * 20;
                const z = (Math.random() - 0.5) * 20;
                const h = 2 + Math.random() * 8;
                
                box.position.set(x, h/2, z);
                box.scale.set(1, h, 1);
                
                // Armazena a cor alvo para a transi√ß√£o suave
                box.userData.targetColor = new THREE.Color(color);
                
                scene.add(box);
                buildings.push(box);
            }
        }
        createCity();
        createParticles();

        // Fun√ß√£o de "Piscar" (Define novos alvos de cor para pr√©dios e part√≠culas simultaneamente)
        function blinkBuildings() {
            // Atualiza Pr√©dios (Vetores/Wireframes)
            buildings.forEach(b => {
                if (Math.random() > 0.6) { 
                    const newColor = neonColors[Math.floor(Math.random() * neonColors.length)];
                    b.userData.targetColor.setHex(newColor);
                }
            });

            // Atualiza Part√≠culas (Efeito de cintila√ß√£o neon)
            if (particles) {
                const colors = particles.geometry.attributes.color.array;
                const tempColor = new THREE.Color();
                for (let i = 0; i < colors.length; i += 3) {
                    if (Math.random() > 0.8) { // Altera cerca de 20% das part√≠culas para dinamismo
                        const randomColor = neonColors[Math.floor(Math.random() * neonColors.length)];
                        tempColor.setHex(randomColor);
                        colors[i] = tempColor.r;
                        colors[i + 1] = tempColor.g;
                        colors[i + 2] = tempColor.b;
                    }
                }
                particles.geometry.attributes.color.needsUpdate = true;
            }
        }
        setInterval(blinkBuildings, 1500);

        // --- CONFIGURA√á√ÉO DO BLOOM (GLOW) ---
        const renderScene = new THREE.RenderPass(scene, camera);
        const bloomPass = new THREE.UnrealBloomPass(
            new THREE.Vector2(container.clientWidth, container.clientHeight),
            2.5,  // For√ßa do brilho (Aumentado para intensidade neon)
            1.0,  // Raio (Aumentado para um halo mais suave)
            0.0   // Threshold (Zerado para brilhar mesmo em linhas finas)
        );
        bloomPass.threshold = 0;
        bloomPass.strength = 2.5;
        bloomPass.radius = 1.0;

        const composer = new THREE.EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        // Adicionar luz ambiente b√°sica para ver os volumes
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);

        // Ch√£o 3D (Grid) para ancorar os pr√©dios e refor√ßar a profundidade
        const gridHelper = new THREE.GridHelper(100, 60, 0x22d3ee, 0x22d3ee);
        gridHelper.position.y = 0;
        gridHelper.material.opacity = 0.15;
        gridHelper.material.transparent = true;
        scene.add(gridHelper);

        // Loop de Anima√ß√£o
        function animate() {
            requestAnimationFrame(animate);
            
            // Suaviza a transi√ß√£o de cores (Lerp)
            buildings.forEach(b => {
                // Sincroniza a cor do wireframe (filho) com a cor alvo de forma suave
                if (b.children[0]) {
                    b.children[0].material.color.lerp(b.userData.targetColor, 0.05);
                }
            });

            // Anima√ß√£o das part√≠culas (Flutua√ß√£o suave e rota√ß√£o)
            if (particles) {
                particles.rotation.y += 0.0003;
                // Movimento vertical suave usando Math.sin
                particles.position.y = Math.sin(Date.now() * 0.0005) * 0.4;
            }

            controls.update();
            composer.render(); // Usa o composer em vez do renderer
        }
        animate();

        // Ajuste de Redimensionamento
        window.addEventListener('resize', () => {
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            renderer.setSize(width, height);
            composer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });

        // --- L√ìGICA DE TOAST E CONTADOR DIN√ÇMICO ---
        
        // 1. Atualiza√ß√£o Fren√©tica dos N√∫meros (Visitantes)
        function updateCounters() {
            const counters = document.querySelectorAll('.visitor-counter');
            counters.forEach(counter => {
                let current = parseInt(counter.innerText) || 28;
                let change = Math.floor(Math.random() * 24) - 8; 
                let next = current + change;
                if (next < 15) next = 15 + Math.floor(Math.random() * 10);
                if (next > 350) next = 340;
                counter.innerText = next;
            });
            setTimeout(updateCounters, Math.random() * 2000 + 500);
        }
        updateCounters();

        // Sistema de Notifica√ß√µes (Toast)
        function spawnToast(type) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            let config;
            if (type === 'user') {
                config = { text: "Voc√™ entrou na fila!", icon: "star", color: "yellow" };
            } else if (type === 'join') {
                config = { text: "Novo jogador na fila", icon: "user-plus", color: "cyan" };
            } else if (type === 'move') {
                config = { text: "A fila andou!", icon: "arrow-up", color: "fuchsia" };
            } else {
                config = { text: "+1 pessoa entrou no jogo", icon: "user-check", color: "green" };
            }

            const toast = document.createElement('div');
            toast.className = `
                bg-gray-900/90 border-l-4 border-${config.color}-500 text-white p-3 rounded-lg shadow-lg mb-2 
                transform transition-all duration-300 translate-x-full opacity-0 
                flex items-center gap-3 backdrop-blur-sm pointer-events-none w-64
            `;
            
            toast.innerHTML = `
                <div class="bg-${config.color}-500/20 p-2 rounded-full">
                    <i data-lucide="${config.icon}" class="w-4 h-4 text-${config.color}-400"></i>
                </div>
                <div>
                    <p class="text-xs font-bold text-gray-200">${config.text}</p>
                </div>
            `;
            
            container.appendChild(toast);
            if (typeof lucide !== 'undefined') lucide.createIcons();

            requestAnimationFrame(() => toast.classList.remove('translate-x-full', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // --- GAME LOOP PRINCIPAL ---
        setInterval(() => {
            // 1. Simula sa√≠da de jogadores (libera vagas)
            // Isso cria o espa√ßo necess√°rio para a fila andar
            if (Math.random() > 0.6) {
                serverState.currentOnline--;
            }

            // 2. L√≥gica de Processamento da Fila
            // Se tem vaga (< 800) e tem gente na fila (> 0), move a fila
            if (serverState.currentOnline < 800 && serverState.queueSize > 0) {
                serverState.queueSize--;      // Decrementa fila
                serverState.currentOnline++;  // Incrementa online
                
                // Se o usu√°rio estiver na fila, decremente sua posi√ß√£o
                if (serverState.userPosition !== null) {
                    serverState.userPosition--;
                    // Feedback visual
                    if (serverState.userPosition > 0) spawnToast('move');
                }
            }

            // 3. Novos 'bots' entrando na fila periodicamente
            // Aumenta o queueSize total sem afetar a userPosition (entram depois do jogador)
            if (Math.random() > 0.5) {
                serverState.queueSize++;
            }

            // Limites de seguran√ßa para manter a imers√£o
            if (serverState.currentOnline < 750) serverState.currentOnline = 750;
            if (serverState.currentOnline > 800) serverState.currentOnline = 800;

            updateServerDisplay();

        }, 1500);

        // L√≥gica de Bloqueio de Coment√°rios
        const commentForm = document.getElementById('comment-form');
        const commentError = document.getElementById('comment-error');

        if (commentForm) {
            commentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                commentError.classList.remove('hidden');
            });
        }

      } catch (error) {
        console.error("Erro cr√≠tico na inicializa√ß√£o:", error);
        alert("Ocorreu um erro ao inicializar o ambiente 3D.\nErro: " + error.message + "\n\nVerifique sua conex√£o com a internet ou se o navegador suporta WebGL.");
      }
    });
    </script>
</body>
</html>

